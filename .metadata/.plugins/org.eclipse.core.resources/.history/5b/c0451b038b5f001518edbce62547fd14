package click.rmx.engine;


import org.lwjgl.BufferUtils;
import org.lwjgl.glfw.*;
import org.lwjgl.opengl.*;
//import org.lwjgl.util.Display;
//import org.lwjgl.util.glu.GLU;

import click.rmx.Bugger;
import click.rmx.RMX;
import click.rmx.RMXObject;
import click.rmx.engine.behaviours.Behaviour;
import click.rmx.engine.gl.CursorCallback;
import click.rmx.engine.gl.GLView;
import click.rmx.engine.gl.KeyCallback;
import click.rmx.engine.gl.SharedLibraryLoader;

import java.lang.management.GarbageCollectorMXBean;
import java.lang.management.ManagementFactory;
import java.nio.ByteBuffer;
import java.nio.FloatBuffer;
import java.time.Duration;
import java.time.Instant;
import java.util.LinkedList;
import java.util.List;

import static click.rmx.RMX.*;
import static org.lwjgl.glfw.Callbacks.*;
import static org.lwjgl.glfw.GLFW.*;
import static org.lwjgl.opengl.GL11.*;
//import static org.lwjgl.opengl.GL15.GL_ARRAY_BUFFER;
//import static org.lwjgl.opengl.GL15.GL_ELEMENT_ARRAY_BUFFER;
//import static org.lwjgl.opengl.GL15.GL_STATIC_DRAW;
//import static org.lwjgl.opengl.GL15.glBindBuffer;
//import static org.lwjgl.opengl.GL15.glBufferData;
//import static org.lwjgl.opengl.GL15.glGenBuffers;
//import static org.lwjgl.opengl.GL20.glEnableVertexAttribArray;
//import static org.lwjgl.opengl.GL20.glVertexAttribPointer;
//import static org.lwjgl.opengl.GL30.glBindVertexArray;
//import static org.lwjgl.opengl.GL30.glGenVertexArrays;
import static org.lwjgl.system.MemoryUtil.*;

public class GameView1 extends AbstractGLView implements GLView{


	@Override
	protected void onAwake() {
		this.setDebugging(true, 60);
		this.setPerFramDebugInfo(RMX::rmxGarbageCollectorInfo);
	}

	@Override
	public void initGL(long window) {		
		GL11.glEnable(GL11.GL_TEXTURE_2D);
		GL11.glShadeModel(GL11.GL_SMOOTH);
		GL11.glClearColor(0.0f, 0.0f, 0.0f, 0.0f); 
		GL11.glClearDepth(1.0); 
		GL11.glEnable(GL11.GL_DEPTH_TEST);
		GL11.glDepthFunc(GL11.GL_LEQUAL); 

		setUpLighting();
	}


	protected void setUpLighting() {
		glShadeModel(GL_SMOOTH);
		glEnable(GL_DEPTH_TEST);
		glEnable(GL_LIGHTING);
		glEnable(GL_LIGHT0);
		FloatBuffer fb = BufferUtils.createFloatBuffer(4);
		fb.put(new float[]{0.05f, 0.05f, 0.05f, 1f});
		fb.flip();
		glLightModelfv(GL_LIGHT_MODEL_AMBIENT, fb);
		FloatBuffer fp = BufferUtils.createFloatBuffer(4);
		fp.put(new float[]{50, 100, 50, 1});
		fp.flip();
		glLightfv(GL_LIGHT0, GL_POSITION, fp);
		glEnable(GL_CULL_FACE);
		glCullFace(GL_BACK);
		glEnable(GL_COLOR_MATERIAL);
		glColorMaterial(GL_FRONT, GL_DIFFUSE);
	}




	@Override
	protected void renderFrame(Scene scene) {
		scene.updateSceneLogic();
		glMatrixMode(GL_PROJECTION);
		glLoadIdentity();
		pointOfView().camera().perspective(this);
		
		glClearColor(0.3f, 0.3f, 0.3f, 0.3f);
		glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); // clear the framebuffer
		glMatrixMode(GL_MODELVIEW);
		glHint(GL11.GL_PERSPECTIVE_CORRECTION_HINT, GL11.GL_NICEST);
		glLoadIdentity();  

		scene.renderScene(pointOfView().camera());
	}

	@Override
	protected void prepareFrameForRender(Scene scene) {		
		
	}


}