package click.rmx.engine;



import click.rmx.Bugger;
import click.rmx.RMXObject;
import click.rmx.engine.math.Matrix4;

public class Scene extends RMXObject {
	
	
	private PhysicsWorld physicsWorld = new PhysicsWorld();
	public final Node rootNode = new Node();
	static node current = new node(null,null,null);
	
	public Scene() {
		Bugger.log("Scene initializing...");
	}
	
//	private static Scene current;
	public static Scene getCurrent() {
		Bugger.log("Get current scene...");
		if (current.scene != null)
			return current.scene;
		else
			current.scene = new Scene();
		return current.scene;
	}
	
	public static Scene setCurrent(Scene scene) {
		current.next = new node(current, scene,null);
		current = current.next;
		return current.prev.scene;
	}
	
	public void makeCurrent() {
		setCurrent(this);
	}
	
	
	
	protected static class node {
        Scene scene;
        node next;
        node prev;

        node(node prev, Scene scene, node next) {
            this.scene = scene;
            this.next = next;
            this.prev = prev;
        }
     
    }
	
	private RenderDelegate renderDelegate;
	

	public void renderScene(Camera cam) {
		 if (this.renderDelegate != null) 
     		this.renderDelegate.updateBeforeSceneRender(cam);
//		cam.look();
		Matrix4 modelMatrix = cam.modelViewMatrix();
		//modelMatrix.negate();
		for (Node child : this.rootNode.getChildren()) {
			child.draw(modelMatrix);
		}
		
	}


	public void updateSceneLogic() {
		 if (this.renderDelegate != null) 
	     		this.renderDelegate.updateBeforeSceneLogic();
		this.physicsWorld.updatePhysics(this.rootNode);
		this.rootNode.updateLogic();
	}

	public RenderDelegate getRenderDelegate() {
		return renderDelegate;
	}

	public void setRenderDelegate(RenderDelegate renderDelegate) {
		this.renderDelegate = renderDelegate;
	}

}
